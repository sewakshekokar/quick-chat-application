{"ast":null,"code":"import{useEffect,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import{getLoggedUser,getAllUsers}from'./../apiCalls/users';import{useDispatch,useSelector}from\"react-redux\";import{hideLoader,showLoader}from\"../redux/loaderSlice\";import toast from\"react-hot-toast\";import{setAllUsers,setUser,setAllChats}from\"../redux/usersSlice\";import{getAllChats}from\"../apiCalls/chat\";import{jsx as _jsx}from\"react/jsx-runtime\";function ProtectedRoute(_ref){let{children}=_ref;const{user}=useSelector(state=>state.userReducer);const dispatch=useDispatch();const navigate=useNavigate();const getloggedInUser=async()=>{let response=null;try{dispatch(showLoader());response=await getLoggedUser();dispatch(hideLoader());if(response.success){dispatch(setUser(response.data));}else{toast.error(response.message);window.location.href='/login';}}catch(error){dispatch(hideLoader());navigate('/login');}};const getAllUsersFromDb=async()=>{let response=null;try{dispatch(showLoader());response=await getAllUsers();dispatch(hideLoader());if(response.success){dispatch(setAllUsers(response.data));}else{toast.error(response.message);window.location.href='/login';}}catch(error){dispatch(hideLoader());navigate('/login');}};const getCurrentUserChats=async()=>{try{const response=await getAllChats();if(response.success){dispatch(setAllChats(response.data));}}catch(error){navigate('/login');}};useEffect(()=>{if(localStorage.getItem('token')){getloggedInUser();getAllUsersFromDb();getCurrentUserChats();}else{navigate('/login');}},[]);return/*#__PURE__*/_jsx(\"div\",{children:children});}export default ProtectedRoute;","map":{"version":3,"names":["useEffect","useState","useNavigate","getLoggedUser","getAllUsers","useDispatch","useSelector","hideLoader","showLoader","toast","setAllUsers","setUser","setAllChats","getAllChats","jsx","_jsx","ProtectedRoute","_ref","children","user","state","userReducer","dispatch","navigate","getloggedInUser","response","success","data","error","message","window","location","href","getAllUsersFromDb","getCurrentUserChats","localStorage","getItem"],"sources":["/Users/sewak/Desktop/quick-chat-application/client/src/components/protectedRoute.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { getLoggedUser, getAllUsers } from './../apiCalls/users';\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { hideLoader, showLoader } from \"../redux/loaderSlice\";\r\nimport toast from \"react-hot-toast\";\r\nimport { setAllUsers, setUser, setAllChats } from \"../redux/usersSlice\";\r\nimport { getAllChats } from \"../apiCalls/chat\";\r\n\r\nfunction ProtectedRoute({children}){\r\n    const { user } = useSelector(state => state.userReducer);\r\n    const dispatch = useDispatch();\r\n\r\n    const navigate = useNavigate();\r\n \r\n    const getloggedInUser = async () => {\r\n        let response = null;\r\n        try{\r\n            dispatch(showLoader())\r\n            response = await getLoggedUser();\r\n            dispatch(hideLoader())\r\n\r\n            if(response.success){\r\n                dispatch(setUser(response.data));\r\n            }else{\r\n                toast.error(response.message);\r\n                window.location.href = '/login';\r\n            }\r\n        }catch(error){\r\n            dispatch(hideLoader())\r\n            navigate('/login');\r\n        }\r\n    }\r\n\r\n    const getAllUsersFromDb = async () => {\r\n        let response = null;\r\n        try{\r\n            dispatch(showLoader());\r\n            response = await getAllUsers();\r\n            dispatch(hideLoader());\r\n\r\n            if(response.success){\r\n                dispatch(setAllUsers(response.data));\r\n            }else{\r\n                toast.error(response.message);\r\n                window.location.href = '/login';\r\n            }\r\n        }catch(error){\r\n            dispatch(hideLoader())\r\n            navigate('/login');\r\n        }\r\n    }\r\n\r\n    const getCurrentUserChats = async () => {\r\n        try{\r\n            const response = await getAllChats();\r\n            if(response.success){\r\n                dispatch(setAllChats(response.data))\r\n            }\r\n        }catch(error){\r\n            navigate('/login');\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if(localStorage.getItem('token')){\r\n            getloggedInUser();\r\n            getAllUsersFromDb();\r\n            getCurrentUserChats();\r\n        }else{\r\n            navigate('/login');\r\n        }\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            { children }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ProtectedRoute;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}